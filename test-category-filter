// test-category-filter.js
const fetch = require('node-fetch');

const FILSTAR_TOKEN = process.env.FILSTAR_API_TOKEN;
const FILSTAR_API_BASE = 'https://filstar.com/api';

async function testCategoryFilters() {
  console.log('üß™ Testing Filstar API category filters...\n');
  
  const testsToRun = [
    { url: `${FILSTAR_API_BASE}/products?category_id=87&limit=10`, desc: 'Filter by category_id=87 (sets)' },
    { url: `${FILSTAR_API_BASE}/products?category=87&limit=10`, desc: 'Filter by category=87' },
    { url: `${FILSTAR_API_BASE}/products?parent_category_id=10&limit=10`, desc: 'Filter by parent_category_id=10' },
    { url: `${FILSTAR_API_BASE}/products?categories=87&limit=10`, desc: 'Filter by categories=87' },
    { url: `${FILSTAR_API_BASE}/products?limit=10`, desc: 'No filter (baseline)' }
  ];
  
  for (const test of testsToRun) {
    console.log(`\nüìç ${test.desc}`);
    console.log(`   URL: ${test.url}`);
    
    try {
      const response = await fetch(test.url, {
        headers: { 'Authorization': `Bearer ${FILSTAR_TOKEN}` }
      });
      
      if (!response.ok) {
        console.log(`   ‚ùå Status: ${response.status}`);
        continue;
      }
      
      const products = await response.json();
      console.log(`   ‚úÖ Returned: ${products.length} products`);
      
      if (products.length > 0) {
        const firstProduct = products[0];
        console.log(`   üì¶ First product: ${firstProduct.name}`);
        console.log(`   üè∑Ô∏è  Categories: ${firstProduct.categories?.map(c => `${c.name} (${c.id})`).join(', ')}`);
      }
      
      await new Promise(r => setTimeout(r, 500));
      
    } catch (error) {
      console.log(`   ‚ùå Error: ${error.message}`);
    }
  }
}

testCategoryFilters();
